var request = require('request');
var _ = require('underscore');
var tournament_sm = require('StickerMap').TournamentStickerMap;
var team_sm = require('StickerMap').TeamStickerMap;
var team_map = require('StickerMap').TeamMap;
var tournament_map = require('StickerMap').TournamentMap;
var MongoClient = require('mongodb').MongoClient;
var test = require('assert');
var db_name = "oxlef";
var db_url = "mongodb://localhost:27017/oxlefdb";

MongoClient.connect(db_url, function (err, db) {

	//id = [stickername], full=[Boolean: get full sales history], time=[Integer: past x days avg/median summary]
	var get_data = function(id, callback, callback_params, full, time) {
		var base_api = "http://csgobackpack.net/api/GetItemPrice/";
		var params = {"currency": "USD", "id": id};

		if(full) {
			params["full"] = full;
		}
		if(time) {
			params["time"] = time;
		}
		
		//Construct api call request string
		var api_call = base_api;
		var index = 0;
		_.each(params, function(value, key) {
			if(index == 0) {
				api_call += "?";
			} else {
				api_call += "&";
			}
			api_call += key + "=" + encodeURI(value);
			++index;
		});

		console.log("Making request to: " + api_call);
		var body = '[["Feb 27 2015 01: +0",1.018,"577"],["Feb 28 2015 01: +0",0.985,"285"],["Mar 01 2015 01: +0",0.98,"249"],["Mar 02 2015 01: +0",0.972,"163"],["Mar 03 2015 01: +0",0.975,"160"],["Mar 04 2015 01: +0",0.973,"118"],["Mar 05 2015 01: +0",0.964,"143"],["Mar 06 2015 01: +0",0.958,"114"],["Mar 07 2015 01: +0",0.945,"189"],["Mar 08 2015 01: +0",0.951,"148"],["Mar 09 2015 01: +0",0.939,"109"],["Mar 10 2015 01: +0",0.93,"144"],["Mar 11 2015 01: +0",1.002,"97"],["Mar 12 2015 01: +0",1.005,"171"],["Mar 13 2015 01: +0",0.758,"1258"],["Mar 14 2015 01: +0",0.372,"2336"],["Mar 15 2015 01: +0",0.324,"12583"],["Mar 16 2015 01: +0",0.318,"6683"],["Mar 17 2015 01: +0",0.389,"1516"],["Mar 18 2015 01: +0",0.386,"1164"],["Mar 19 2015 01: +0",0.372,"1167"],["Mar 20 2015 01: +0",0.368,"1081"],["Mar 21 2015 01: +0",0.384,"1312"],["Mar 22 2015 01: +0",0.392,"1009"],["Mar 23 2015 01: +0",0.379,"916"],["Mar 24 2015 01: +0",0.386,"927"],["Mar 25 2015 01: +0",0.381,"770"],["Mar 26 2015 01: +0",0.389,"805"],["Mar 27 2015 01: +0",0.386,"883"],["Mar 28 2015 01: +0",0.4,"888"],["Mar 29 2015 01: +0",0.398,"862"],["Mar 30 2015 01: +0",0.387,"763"],["Mar 31 2015 01: +0",0.403,"750"],["Apr 01 2015 01: +0",0.393,"932"],["Apr 02 2015 01: +0",0.409,"890"],["Apr 03 2015 01: +0",0.433,"796"],["Apr 04 2015 01: +0",0.436,"829"],["Apr 05 2015 01: +0",0.451,"869"],["Apr 06 2015 01: +0",0.472,"736"],["Apr 07 2015 01: +0",0.473,"846"],["Apr 08 2015 01: +0",0.523,"898"],["Apr 09 2015 01: +0",0.506,"670"],["Apr 10 2015 01: +0",0.503,"668"],["Apr 11 2015 01: +0",0.512,"760"],["Apr 12 2015 01: +0",0.523,"587"],["Apr 13 2015 01: +0",0.489,"453"],["Apr 14 2015 01: +0",0.447,"614"],["Apr 15 2015 01: +0",0.443,"504"],["Apr 16 2015 01: +0",0.422,"662"],["Apr 17 2015 01: +0",0.415,"781"],["Apr 18 2015 01: +0",0.442,"846"],["Apr 19 2015 01: +0",0.445,"602"],["Apr 20 2015 01: +0",0.449,"598"],["Apr 21 2015 01: +0",0.443,"507"],["Apr 22 2015 01: +0",0.457,"571"],["Apr 23 2015 01: +0",0.466,"466"],["Apr 24 2015 01: +0",0.477,"694"],["Apr 25 2015 01: +0",0.524,"687"],["Apr 26 2015 01: +0",0.497,"669"],["Apr 27 2015 01: +0",0.52,"523"],["Apr 28 2015 01: +0",0.53,"448"],["Apr 29 2015 01: +0",0.559,"496"],["Apr 30 2015 01: +0",0.593,"521"],["May 01 2015 01: +0",0.592,"476"],["May 02 2015 01: +0",0.605,"511"],["May 03 2015 01: +0",0.607,"502"],["May 04 2015 01: +0",0.599,"448"],["May 05 2015 01: +0",0.617,"419"],["May 06 2015 01: +0",0.609,"390"],["May 07 2015 01: +0",0.63,"396"],["May 08 2015 01: +0",0.66,"448"],["May 09 2015 01: +0",0.649,"452"],["May 10 2015 01: +0",0.665,"372"],["May 11 2015 01: +0",0.682,"306"],["May 12 2015 01: +0",0.714,"297"],["May 13 2015 01: +0",0.692,"329"],["May 14 2015 01: +0",0.713,"359"],["May 15 2015 01: +0",0.72,"354"],["May 16 2015 01: +0",0.755,"371"],["May 17 2015 01: +0",0.772,"418"],["May 18 2015 01: +0",0.784,"298"],["May 19 2015 01: +0",0.744,"268"],["May 20 2015 01: +0",0.776,"195"],["May 21 2015 01: +0",0.762,"331"],["May 22 2015 01: +0",0.754,"381"],["May 23 2015 01: +0",0.749,"475"],["May 24 2015 01: +0",0.776,"395"],["May 25 2015 01: +0",0.767,"371"],["May 26 2015 01: +0",0.772,"374"],["May 27 2015 01: +0",0.535,"764"],["May 28 2015 01: +0",0.72,"368"],["May 29 2015 01: +0",0.75,"389"],["May 30 2015 01: +0",0.767,"400"],["May 31 2015 01: +0",0.792,"360"],["Jun 01 2015 01: +0",0.803,"353"],["Jun 02 2015 01: +0",0.776,"316"],["Jun 03 2015 01: +0",0.796,"325"],["Jun 04 2015 01: +0",0.788,"366"],["Jun 05 2015 01: +0",0.784,"379"],["Jun 06 2015 01: +0",0.789,"299"],["Jun 07 2015 01: +0",0.79,"359"],["Jun 08 2015 01: +0",0.796,"590"],["Jun 09 2015 01: +0",0.906,"370"],["Jun 10 2015 01: +0",0.795,"305"],["Jun 11 2015 01: +0",0.818,"306"],["Jun 12 2015 01: +0",0.795,"301"],["Jun 13 2015 01: +0",0.791,"341"],["Jun 14 2015 01: +0",0.813,"322"],["Jun 15 2015 01: +0",0.824,"286"],["Jun 16 2015 01: +0",0.838,"263"],["Jun 17 2015 01: +0",0.812,"231"],["Jun 18 2015 01: +0",0.821,"282"],["Jun 19 2015 01: +0",0.83,"262"],["Jun 20 2015 01: +0",0.819,"313"],["Jun 21 2015 01: +0",0.814,"290"],["Jun 22 2015 01: +0",0.827,"260"],["Jun 23 2015 01: +0",0.866,"224"],["Jun 24 2015 01: +0",0.882,"236"],["Jun 25 2015 01: +0",0.959,"231"],["Jun 26 2015 01: +0",0.949,"302"],["Jun 27 2015 01: +0",0.989,"281"],["Jun 28 2015 01: +0",0.993,"201"],["Jun 29 2015 01: +0",1.029,"233"],["Jun 30 2015 01: +0",1.023,"159"],["Jul 01 2015 01: +0",1.01,"176"],["Jul 02 2015 01: +0",1.032,"307"],["Jul 03 2015 01: +0",1.23,"311"],["Jul 04 2015 01: +0",1.408,"362"],["Jul 05 2015 01: +0",1.451,"474"],["Jul 06 2015 01: +0",1.594,"420"],["Jul 07 2015 01: +0",1.786,"216"],["Jul 08 2015 01: +0",2.09,"166"],["Jul 09 2015 01: +0",1.873,"250"],["Jul 10 2015 01: +0",1.923,"197"],["Jul 11 2015 01: +0",2.228,"238"],["Jul 12 2015 01: +0",2.648,"283"],["Jul 13 2015 01: +0",2.501,"199"],["Jul 14 2015 01: +0",2.555,"177"],["Jul 15 2015 01: +0",2.355,"178"],["Jul 16 2015 01: +0",2.221,"209"],["Jul 17 2015 01: +0",2.312,"191"],["Jul 18 2015 01: +0",2.37,"288"],["Jul 19 2015 01: +0",2.576,"308"],["Jul 20 2015 01: +0",2.609,"197"],["Jul 21 2015 01: +0",2.677,"176"],["Jul 22 2015 01: +0",2.848,"270"],["Jul 23 2015 01: +0",2.911,"176"],["Jul 24 2015 01: +0",2.925,"144"],["Jul 25 2015 01: +0",3.032,"184"],["Jul 26 2015 01: +0",3.093,"165"],["Jul 27 2015 01: +0",3.101,"161"],["Jul 28 2015 01: +0",2.831,"139"],["Jul 29 2015 01: +0",2.619,"147"],["Jul 30 2015 01: +0",2.362,"205"],["Jul 31 2015 01: +0",2.55,"189"],["Aug 01 2015 01: +0",2.29,"141"],["Aug 02 2015 01: +0",2.173,"225"],["Aug 03 2015 01: +0",2.382,"179"],["Aug 04 2015 01: +0",2.401,"220"],["Aug 05 2015 01: +0",2.325,"170"],["Aug 06 2015 01: +0",2.226,"179"],["Aug 07 2015 01: +0",2.115,"218"],["Aug 08 2015 01: +0",2.141,"169"],["Aug 09 2015 01: +0",2.099,"183"],["Aug 10 2015 01: +0",2.065,"182"],["Aug 11 2015 01: +0",1.984,"220"],["Aug 12 2015 01: +0",2.011,"240"],["Aug 13 2015 01: +0",2.156,"186"],["Aug 14 2015 01: +0",2.171,"176"],["Aug 15 2015 01: +0",1.829,"256"],["Aug 16 2015 01: +0",1.861,"129"],["Aug 17 2015 01: +0",1.809,"108"],["Aug 18 2015 01: +0",1.68,"99"],["Aug 19 2015 01: +0",1.546,"152"],["Aug 20 2015 01: +0",1.429,"160"],["Aug 21 2015 01: +0",1.513,"152"],["Aug 22 2015 01: +0",1.404,"153"],["Aug 23 2015 01: +0",1.484,"315"],["Aug 24 2015 01: +0",1.473,"162"],["Aug 25 2015 01: +0",1.793,"119"],["Aug 26 2015 01: +0",1.842,"75"],["Aug 27 2015 01: +0",1.803,"61"],["Aug 28 2015 01: +0",1.665,"82"],["Aug 29 2015 01: +0",1.858,"85"],["Aug 30 2015 01: +0",1.923,"84"],["Aug 31 2015 01: +0",1.902,"53"],["Sep 01 2015 01: +0",1.829,"57"],["Sep 02 2015 01: +0",1.65,"66"],["Sep 03 2015 01: +0",1.533,"72"],["Sep 04 2015 01: +0",1.597,"75"],["Sep 05 2015 01: +0",1.675,"92"],["Sep 06 2015 01: +0",1.642,"86"],["Sep 07 2015 01: +0",1.717,"70"],["Sep 08 2015 01: +0",1.645,"55"],["Sep 09 2015 01: +0",1.714,"43"],["Sep 10 2015 01: +0",1.733,"73"],["Sep 11 2015 01: +0",1.708,"63"],["Sep 12 2015 01: +0",1.704,"80"],["Sep 13 2015 01: +0",1.552,"67"],["Sep 14 2015 01: +0",1.6,"65"],["Sep 15 2015 01: +0",1.7,"77"],["Sep 16 2015 01: +0",1.749,"99"],["Sep 17 2015 01: +0",1.734,"71"],["Sep 18 2015 01: +0",1.692,"102"],["Sep 19 2015 01: +0",1.794,"87"],["Sep 20 2015 01: +0",1.757,"103"],["Sep 21 2015 01: +0",1.782,"40"],["Sep 22 2015 01: +0",1.854,"73"],["Sep 23 2015 01: +0",1.795,"84"],["Sep 24 2015 01: +0",1.777,"67"],["Sep 25 2015 01: +0",1.778,"59"],["Sep 26 2015 01: +0",1.795,"74"],["Sep 27 2015 01: +0",1.719,"76"],["Sep 28 2015 01: +0",1.692,"56"],["Sep 29 2015 01: +0",1.705,"60"],["Sep 30 2015 01: +0",1.696,"57"],["Oct 01 2015 01: +0",1.751,"75"],["Oct 02 2015 01: +0",1.746,"64"],["Oct 03 2015 01: +0",1.846,"80"],["Oct 04 2015 01: +0",1.753,"56"],["Oct 05 2015 01: +0",1.813,"49"],["Oct 06 2015 01: +0",1.762,"53"],["Oct 07 2015 01: +0",1.737,"48"],["Oct 08 2015 01: +0",1.813,"51"],["Oct 09 2015 01: +0",1.845,"43"],["Oct 10 2015 01: +0",1.73,"71"],["Oct 11 2015 01: +0",1.705,"59"],["Oct 12 2015 01: +0",1.773,"73"],["Oct 13 2015 01: +0",1.771,"48"],["Oct 14 2015 01: +0",1.77,"52"],["Oct 15 2015 01: +0",1.739,"62"],["Oct 16 2015 01: +0",1.768,"76"],["Oct 17 2015 01: +0",1.767,"80"],["Oct 18 2015 01: +0",1.687,"83"],["Oct 19 2015 01: +0",1.786,"78"],["Oct 20 2015 01: +0",1.838,"68"],["Oct 21 2015 01: +0",1.534,"81"],["Oct 22 2015 01: +0",1.603,"60"],["Oct 23 2015 01: +0",1.564,"70"],["Oct 24 2015 01: +0",1.744,"83"],["Oct 25 2015 01: +0",1.722,"63"],["Oct 26 2015 01: +0",1.679,"58"],["Oct 27 2015 01: +0",1.515,"58"],["Oct 28 2015 01: +0",1.41,"64"],["Oct 29 2015 01: +0",1.531,"60"],["Oct 30 2015 01: +0",1.53,"53"],["Oct 31 2015 01: +0",1.527,"56"],["Nov 01 2015 01: +0",1.367,"125"],["Nov 02 2015 01: +0",1.351,"47"],["Nov 03 2015 01: +0",1.584,"53"],["Nov 04 2015 01: +0",1.716,"51"],["Nov 05 2015 01: +0",1.678,"57"],["Nov 06 2015 01: +0",1.655,"41"],["Nov 07 2015 01: +0",1.677,"40"],["Nov 08 2015 01: +0",1.633,"49"],["Nov 09 2015 01: +0",1.636,"40"],["Nov 10 2015 01: +0",1.66,"45"],["Nov 11 2015 01: +0",1.621,"40"],["Nov 12 2015 01: +0",1.498,"40"],["Nov 13 2015 01: +0",1.439,"100"],["Nov 14 2015 01: +0",1.438,"48"],["Nov 15 2015 01: +0",1.591,"62"],["Nov 16 2015 01: +0",1.645,"45"],["Nov 17 2015 01: +0",1.669,"48"],["Nov 18 2015 01: +0",1.723,"57"],["Nov 19 2015 01: +0",1.738,"46"],["Nov 20 2015 01: +0",1.83,"51"],["Nov 21 2015 01: +0",1.891,"57"],["Nov 22 2015 01: +0",1.989,"51"],["Nov 23 2015 01: +0",1.944,"40"],["Nov 24 2015 01: +0",1.986,"57"],["Nov 25 2015 01: +0",2.058,"49"],["Nov 26 2015 01: +0",1.93,"63"],["Nov 27 2015 01: +0",1.891,"50"],["Nov 28 2015 01: +0",1.822,"69"],["Nov 29 2015 01: +0",1.881,"61"],["Nov 30 2015 01: +0",1.904,"48"],["Dec 01 2015 01: +0",1.89,"42"],["Dec 02 2015 01: +0",1.875,"41"],["Dec 03 2015 01: +0",2.005,"48"],["Dec 04 2015 01: +0",2.133,"63"],["Dec 05 2015 01: +0",2.635,"56"],["Dec 06 2015 01: +0",2.555,"53"],["Dec 07 2015 01: +0",2.433,"28"],["Dec 08 2015 01: +0",2.383,"50"],["Dec 09 2015 01: +0",2.39,"43"],["Dec 10 2015 01: +0",2.504,"35"],["Dec 11 2015 01: +0",2.518,"24"],["Dec 12 2015 01: +0",2.538,"29"],["Dec 13 2015 01: +0",2.682,"53"],["Dec 14 2015 01: +0",2.757,"48"],["Dec 15 2015 01: +0",2.949,"32"],["Dec 16 2015 01: +0",2.819,"39"],["Dec 17 2015 01: +0",2.588,"40"],["Dec 18 2015 01: +0",2.684,"31"],["Dec 19 2015 01: +0",2.814,"20"],["Dec 20 2015 01: +0",2.734,"36"],["Dec 21 2015 01: +0",3.056,"45"],["Dec 22 2015 01: +0",3.194,"47"],["Dec 23 2015 01: +0",2.535,"65"],["Dec 24 2015 01: +0",2.561,"43"],["Dec 25 2015 01: +0",2.86,"59"],["Dec 26 2015 01: +0",3.418,"79"],["Dec 27 2015 01: +0",3.855,"60"],["Dec 28 2015 01: +0",4.391,"40"],["Dec 29 2015 01: +0",5.116,"59"],["Dec 30 2015 01: +0",5.15,"33"],["Dec 31 2015 01: +0",5.031,"36"],["Jan 01 2016 01: +0",4.955,"52"],["Jan 02 2016 01: +0",4.211,"42"],["Jan 03 2016 01: +0",4.259,"56"],["Jan 04 2016 01: +0",4.496,"39"],["Jan 05 2016 01: +0",4.906,"71"],["Jan 06 2016 01: +0",6.2,"36"],["Jan 07 2016 01: +0",6.76,"36"],["Jan 08 2016 01: +0",6.064,"36"],["Jan 09 2016 01: +0",5.652,"54"],["Jan 10 2016 01: +0",5.778,"32"],["Jan 11 2016 01: +0",5.441,"30"],["Jan 12 2016 01: +0",4.567,"34"],["Jan 13 2016 01: +0",4.754,"27"],["Jan 14 2016 01: +0",4.776,"51"],["Jan 15 2016 01: +0",5.131,"41"],["Jan 16 2016 01: +0",5.139,"39"],["Jan 17 2016 01: +0",5.399,"32"],["Jan 18 2016 01: +0",5.406,"28"],["Jan 19 2016 01: +0",5.239,"13"],["Jan 20 2016 01: +0",4.909,"21"],["Jan 21 2016 01: +0",5.093,"17"],["Jan 22 2016 01: +0",4.723,"32"],["Jan 23 2016 01: +0",4.732,"26"],["Jan 24 2016 01: +0",4.571,"25"],["Jan 25 2016 01: +0",4.41,"31"],["Jan 26 2016 01: +0",4.657,"29"],["Jan 27 2016 01: +0",4.661,"20"],["Jan 28 2016 01: +0",4.276,"22"],["Jan 29 2016 01: +0",4.59,"25"],["Jan 30 2016 01: +0",4.501,"21"],["Jan 31 2016 01: +0",4.223,"30"],["Feb 01 2016 01: +0",4.164,"21"],["Feb 02 2016 01: +0",3.9,"32"],["Feb 03 2016 01: +0",3.829,"26"],["Feb 04 2016 01: +0",3.889,"38"],["Feb 05 2016 01: +0",4.089,"56"],["Feb 06 2016 01: +0",4.179,"35"],["Feb 07 2016 01: +0",3.949,"41"],["Feb 08 2016 01: +0",4.074,"29"],["Feb 09 2016 01: +0",4.012,"23"],["Feb 10 2016 01: +0",3.602,"24"],["Feb 11 2016 01: +0",3.547,"40"],["Feb 12 2016 01: +0",3.727,"34"],["Feb 13 2016 01: +0",4.085,"36"],["Feb 14 2016 01: +0",4.073,"21"],["Feb 15 2016 01: +0",3.993,"26"],["Feb 16 2016 01: +0",4.17,"35"],["Feb 17 2016 01: +0",4.19,"35"],["Feb 18 2016 01: +0",3.498,"78"],["Feb 19 2016 01: +0",3.771,"40"],["Feb 20 2016 01: +0",4.156,"24"],["Feb 21 2016 01: +0",3.994,"30"],["Feb 22 2016 01: +0",3.969,"26"],["Feb 23 2016 01: +0",3.938,"22"],["Feb 24 2016 01: +0",3.808,"24"],["Feb 25 2016 01: +0",3.935,"25"],["Feb 26 2016 01: +0",3.574,"22"],["Feb 27 2016 01: +0",3.868,"57"],["Feb 28 2016 01: +0",4.041,"23"],["Feb 29 2016 01: +0",4.191,"9"],["Feb 29 2016 02: +0",4.226,"1"],["Feb 29 2016 08: +0",3.966,"4"],["Feb 29 2016 09: +0",3.73,"1"],["Feb 29 2016 10: +0",3.996,"4"],["Feb 29 2016 13: +0",3.707,"1"],["Feb 29 2016 15: +0",3.917,"1"],["Feb 29 2016 16: +0",3.546,"3"],["Feb 29 2016 17: +0",3.369,"1"],["Feb 29 2016 18: +0",3.888,"3"],["Feb 29 2016 19: +0",3.866,"2"],["Feb 29 2016 22: +0",3.863,"2"],["Feb 29 2016 23: +0",3.876,"1"],["Mar 01 2016 00: +0",3.587,"1"],["Mar 01 2016 01: +0",3.876,"3"],["Mar 01 2016 02: +0",3.905,"5"],["Mar 01 2016 03: +0",3.967,"3"],["Mar 01 2016 04: +0",4.021,"1"],["Mar 01 2016 06: +0",4.021,"4"],["Mar 01 2016 07: +0",4.074,"1"],["Mar 01 2016 08: +0",4.124,"2"],["Mar 01 2016 10: +0",4.163,"2"],["Mar 01 2016 11: +0",4.214,"4"],["Mar 01 2016 13: +0",4.226,"1"],["Mar 01 2016 15: +0",3.686,"1"],["Mar 01 2016 17: +0",4.012,"1"],["Mar 01 2016 18: +0",4.012,"1"],["Mar 01 2016 19: +0",4.074,"3"],["Mar 01 2016 20: +0",4.158,"4"],["Mar 01 2016 22: +0",3.842,"4"],["Mar 01 2016 23: +0",3.741,"4"],["Mar 02 2016 00: +0",3.856,"1"],["Mar 02 2016 02: +0",3.842,"3"],["Mar 02 2016 03: +0",3.848,"2"],["Mar 02 2016 04: +0",3.842,"1"],["Mar 02 2016 05: +0",3.853,"1"],["Mar 02 2016 06: +0",3.842,"1"],["Mar 02 2016 07: +0",3.842,"1"],["Mar 02 2016 09: +0",3.85,"2"],["Mar 02 2016 10: +0",3.865,"1"],["Mar 02 2016 11: +0",3.596,"1"],["Mar 02 2016 13: +0",3.902,"10"],["Mar 02 2016 14: +0",4.098,"1"],["Mar 02 2016 18: +0",3.899,"2"],["Mar 02 2016 21: +0",3.817,"1"],["Mar 02 2016 23: +0",3.882,"2"],["Mar 03 2016 00: +0",3.958,"2"],["Mar 03 2016 01: +0",3.905,"3"],["Mar 03 2016 02: +0",3.958,"2"],["Mar 03 2016 03: +0",3.637,"1"],["Mar 03 2016 13: +0",3.854,"1"],["Mar 03 2016 14: +0",3.931,"1"],["Mar 03 2016 15: +0",3.935,"1"],["Mar 03 2016 16: +0",3.891,"2"],["Mar 03 2016 18: +0",3.831,"5"],["Mar 03 2016 19: +0",3.941,"4"],["Mar 03 2016 20: +0",3.931,"3"],["Mar 03 2016 21: +0",4.096,"5"],["Mar 03 2016 23: +0",3.907,"2"],["Mar 04 2016 00: +0",4.039,"1"],["Mar 04 2016 02: +0",4.007,"3"],["Mar 04 2016 03: +0",4.054,"5"],["Mar 04 2016 04: +0",4.414,"23"],["Mar 04 2016 05: +0",4.271,"1"],["Mar 04 2016 06: +0",4.468,"3"],["Mar 04 2016 17: +0",3.786,"2"],["Mar 04 2016 18: +0",4.082,"4"],["Mar 04 2016 20: +0",3.574,"1"],["Mar 04 2016 21: +0",3.908,"1"],["Mar 04 2016 22: +0",4.369,"1"],["Mar 04 2016 23: +0",4.459,"1"],["Mar 05 2016 00: +0",4.452,"1"],["Mar 05 2016 01: +0",4.467,"1"],["Mar 05 2016 03: +0",4.468,"5"],["Mar 05 2016 04: +0",4.481,"3"],["Mar 05 2016 06: +0",4.468,"1"],["Mar 05 2016 07: +0",4.494,"1"],["Mar 05 2016 09: +0",4.52,"4"],["Mar 05 2016 11: +0",4.545,"2"],["Mar 05 2016 12: +0",4.609,"1"],["Mar 05 2016 13: +0",3.797,"1"],["Mar 05 2016 14: +0",4.017,"2"],["Mar 05 2016 15: +0",4.288,"1"],["Mar 05 2016 17: +0",4.191,"2"],["Mar 05 2016 18: +0",4.391,"3"],["Mar 05 2016 21: +0",4.324,"1"],["Mar 05 2016 22: +0",4.315,"1"],["Mar 05 2016 23: +0",4.006,"2"],["Mar 06 2016 00: +0",4.267,"2"],["Mar 06 2016 01: +0",4.265,"3"],["Mar 06 2016 03: +0",4.253,"2"],["Mar 06 2016 04: +0",4.28,"1"],["Mar 06 2016 06: +0",4.155,"2"],["Mar 06 2016 07: +0",4.249,"2"],["Mar 06 2016 10: +0",4.334,"3"],["Mar 06 2016 11: +0",4.342,"2"],["Mar 06 2016 12: +0",4.343,"1"],["Mar 06 2016 14: +0",4.432,"1"],["Mar 06 2016 16: +0",4.277,"1"],["Mar 06 2016 18: +0",4.463,"2"],["Mar 06 2016 19: +0",3.931,"1"],["Mar 06 2016 21: +0",4.249,"2"],["Mar 06 2016 23: +0",4.012,"1"],["Mar 07 2016 00: +0",4.324,"4"],["Mar 07 2016 03: +0",4.334,"1"],["Mar 07 2016 04: +0",4.334,"1"],["Mar 07 2016 05: +0",4.334,"1"],["Mar 07 2016 09: +0",4.253,"1"],["Mar 07 2016 10: +0",4.255,"1"],["Mar 07 2016 11: +0",4.255,"3"],["Mar 07 2016 12: +0",4.176,"1"],["Mar 07 2016 14: +0",4.226,"1"],["Mar 07 2016 16: +0",4.235,"2"],["Mar 07 2016 17: +0",3.988,"2"],["Mar 07 2016 18: +0",4.334,"7"],["Mar 07 2016 20: +0",4.468,"2"],["Mar 07 2016 21: +0",4.521,"1"],["Mar 07 2016 22: +0",4.468,"9"],["Mar 07 2016 23: +0",4.548,"1"],["Mar 08 2016 02: +0",4.557,"1"],["Mar 08 2016 03: +0",4.476,"1"],["Mar 08 2016 06: +0",4.155,"1"],["Mar 08 2016 07: +0",4.494,"1"],["Mar 08 2016 08: +0",4.555,"2"],["Mar 08 2016 10: +0",4.547,"1"],["Mar 08 2016 16: +0",4.352,"1"],["Mar 08 2016 19: +0",4.43,"5"],["Mar 08 2016 22: +0",3.797,"1"],["Mar 08 2016 23: +0",3.777,"3"],["Mar 09 2016 00: +0",4.547,"1"],["Mar 09 2016 01: +0",4.557,"4"],["Mar 09 2016 02: +0",4.567,"2"],["Mar 09 2016 05: +0",3.781,"5"],["Mar 09 2016 06: +0",4.519,"1"],["Mar 09 2016 11: +0",4.499,"1"],["Mar 09 2016 15: +0",4.11,"2"],["Mar 09 2016 16: +0",4.073,"2"],["Mar 09 2016 17: +0",4.271,"1"],["Mar 09 2016 22: +0",3.753,"1"],["Mar 10 2016 02: +0",4.057,"1"],["Mar 10 2016 03: +0",4.456,"4"],["Mar 10 2016 09: +0",4.378,"1"],["Mar 10 2016 14: +0",4.105,"1"],["Mar 10 2016 15: +0",4.115,"1"],["Mar 10 2016 17: +0",4.106,"1"],["Mar 10 2016 19: +0",4.106,"1"],["Mar 10 2016 21: +0",3.708,"2"],["Mar 11 2016 00: +0",4.065,"3"],["Mar 11 2016 01: +0",4.074,"1"],["Mar 11 2016 02: +0",3.748,"1"],["Mar 11 2016 03: +0",4.012,"4"],["Mar 11 2016 06: +0",4.012,"4"],["Mar 11 2016 09: +0",4.021,"3"],["Mar 11 2016 13: +0",4.022,"1"],["Mar 11 2016 14: +0",4.191,"3"],["Mar 11 2016 15: +0",4.325,"1"],["Mar 11 2016 17: +0",4.325,"1"],["Mar 11 2016 18: +0",4.301,"1"],["Mar 11 2016 20: +0",4.296,"4"],["Mar 11 2016 21: +0",4.321,"1"],["Mar 12 2016 00: +0",4.262,"1"],["Mar 12 2016 02: +0",4.316,"1"],["Mar 12 2016 05: +0",4.325,"1"],["Mar 12 2016 06: +0",4.322,"1"],["Mar 12 2016 09: +0",4.296,"2"],["Mar 12 2016 12: +0",4.289,"1"],["Mar 12 2016 14: +0",4.27,"1"],["Mar 12 2016 15: +0",4.28,"1"],["Mar 12 2016 19: +0",4.258,"2"],["Mar 12 2016 20: +0",4.182,"1"],["Mar 12 2016 21: +0",4.191,"1"],["Mar 12 2016 22: +0",4.271,"5"],["Mar 13 2016 01: +0",4.29,"1"],["Mar 13 2016 02: +0",4.299,"1"],["Mar 13 2016 03: +0",4.244,"2"],["Mar 13 2016 06: +0",4.307,"2"],["Mar 13 2016 07: +0",4.325,"2"],["Mar 13 2016 08: +0",4.325,"3"],["Mar 13 2016 11: +0",4.325,"2"],["Mar 13 2016 12: +0",4.309,"2"],["Mar 13 2016 14: +0",4.316,"1"],["Mar 13 2016 15: +0",3.654,"1"],["Mar 13 2016 16: +0",3.992,"1"],["Mar 13 2016 18: +0",4.31,"4"],["Mar 13 2016 19: +0",4.277,"2"],["Mar 13 2016 22: +0",4.325,"1"],["Mar 13 2016 23: +0",4.322,"3"],["Mar 14 2016 00: +0",3.972,"1"],["Mar 14 2016 02: +0",4.427,"2"],["Mar 14 2016 03: +0",0.375,"1"],["Mar 14 2016 05: +0",4.439,"7"],["Mar 14 2016 06: +0",3.709,"1"],["Mar 14 2016 07: +0",4.458,"2"],["Mar 14 2016 11: +0",4.417,"1"],["Mar 14 2016 12: +0",4.458,"3"],["Mar 14 2016 14: +0",4.548,"1"],["Mar 14 2016 18: +0",4.18,"2"],["Mar 14 2016 19: +0",4.528,"3"],["Mar 14 2016 20: +0",4.557,"1"],["Mar 14 2016 22: +0",4.448,"1"],["Mar 14 2016 23: +0",4.547,"1"],["Mar 15 2016 00: +0",3.962,"3"],["Mar 15 2016 03: +0",4.557,"3"],["Mar 15 2016 06: +0",4.566,"1"],["Mar 15 2016 11: +0",4.57,"3"],["Mar 15 2016 15: +0",4.482,"4"],["Mar 15 2016 16: +0",4.583,"1"],["Mar 15 2016 20: +0",4.362,"2"],["Mar 15 2016 21: +0",4.369,"2"],["Mar 15 2016 23: +0",4.151,"1"],["Mar 16 2016 01: +0",4.146,"2"],["Mar 16 2016 02: +0",4.146,"1"],["Mar 16 2016 04: +0",4.36,"1"],["Mar 16 2016 06: +0",4.223,"1"],["Mar 16 2016 09: +0",4.342,"1"],["Mar 16 2016 10: +0",4.369,"3"],["Mar 16 2016 13: +0",4.039,"1"],["Mar 16 2016 15: +0",4.146,"1"],["Mar 16 2016 16: +0",4.418,"1"],["Mar 16 2016 21: +0",4.039,"2"],["Mar 16 2016 22: +0",3.967,"1"],["Mar 17 2016 01: +0",3.972,"2"],["Mar 17 2016 02: +0",3.797,"1"],["Mar 17 2016 03: +0",4.021,"1"],["Mar 17 2016 04: +0",4.186,"2"],["Mar 17 2016 06: +0",4.226,"2"],["Mar 17 2016 09: +0",4.205,"2"],["Mar 17 2016 11: +0",4.191,"1"],["Mar 17 2016 13: +0",4.155,"1"],["Mar 17 2016 14: +0",4.191,"1"],["Mar 17 2016 16: +0",4.208,"2"],["Mar 17 2016 18: +0",4.047,"1"],["Mar 17 2016 19: +0",4.047,"1"],["Mar 17 2016 20: +0",3.938,"1"],["Mar 17 2016 22: +0",4.146,"3"],["Mar 18 2016 00: +0",4.296,"3"],["Mar 18 2016 01: +0",4.207,"1"],["Mar 18 2016 02: +0",4.193,"3"],["Mar 18 2016 05: +0",4.28,"1"],["Mar 18 2016 06: +0",4.28,"1"],["Mar 18 2016 12: +0",3.797,"1"],["Mar 18 2016 13: +0",3.797,"1"],["Mar 18 2016 14: +0",3.727,"1"],["Mar 18 2016 15: +0",3.727,"5"],["Mar 18 2016 17: +0",3.719,"8"],["Mar 18 2016 18: +0",3.645,"1"],["Mar 18 2016 19: +0",3.83,"2"],["Mar 18 2016 21: +0",3.826,"1"],["Mar 18 2016 23: +0",3.694,"1"],["Mar 19 2016 00: +0",3.797,"1"],["Mar 19 2016 02: +0",3.727,"1"],["Mar 19 2016 03: +0",3.687,"1"],["Mar 19 2016 04: +0",3.806,"3"],["Mar 19 2016 12: +0",3.261,"1"],["Mar 19 2016 14: +0",3.261,"1"],["Mar 19 2016 17: +0",3.449,"2"],["Mar 19 2016 18: +0",3.038,"2"],["Mar 19 2016 19: +0",3.529,"1"],["Mar 19 2016 23: +0",3.499,"4"],["Mar 20 2016 01: +0",3.467,"3"],["Mar 20 2016 03: +0",3.52,"1"],["Mar 20 2016 04: +0",3.52,"1"],["Mar 20 2016 06: +0",3.021,"4"],["Mar 20 2016 08: +0",3.512,"1"],["Mar 20 2016 12: +0",3.011,"1"],["Mar 20 2016 13: +0",3.434,"1"],["Mar 20 2016 18: +0",3.257,"4"],["Mar 20 2016 19: +0",3.172,"1"],["Mar 20 2016 20: +0",2.96,"1"],["Mar 20 2016 21: +0",3.342,"5"],["Mar 20 2016 23: +0",3.455,"2"],["Mar 21 2016 01: +0",3.51,"1"],["Mar 21 2016 03: +0",3.503,"3"],["Mar 21 2016 04: +0",3.512,"1"],["Mar 21 2016 05: +0",3.717,"11"],["Mar 21 2016 07: +0",3.869,"1"],["Mar 21 2016 09: +0",3.917,"1"],["Mar 21 2016 11: +0",3.714,"2"],["Mar 21 2016 16: +0",3.833,"1"],["Mar 21 2016 17: +0",3.826,"1"],["Mar 21 2016 18: +0",3.494,"1"],["Mar 21 2016 20: +0",3.424,"1"],["Mar 21 2016 21: +0",3.878,"1"],["Mar 21 2016 23: +0",3.891,"4"],["Mar 22 2016 00: +0",3.592,"1"],["Mar 22 2016 01: +0",4.079,"4"],["Mar 22 2016 05: +0",4.11,"3"],["Mar 22 2016 11: +0",4.065,"1"],["Mar 22 2016 12: +0",3.565,"1"],["Mar 22 2016 14: +0",4.052,"1"],["Mar 22 2016 17: +0",3.572,"4"],["Mar 22 2016 18: +0",3.574,"1"],["Mar 22 2016 20: +0",3.076,"1"],["Mar 22 2016 21: +0",3.565,"1"],["Mar 22 2016 23: +0",3.579,"2"],["Mar 23 2016 02: +0",3.574,"1"],["Mar 23 2016 04: +0",3.931,"1"],["Mar 23 2016 05: +0",3.038,"1"],["Mar 23 2016 06: +0",3.907,"1"],["Mar 23 2016 07: +0",3.914,"2"],["Mar 23 2016 08: +0",3.905,"1"],["Mar 23 2016 14: +0",3.512,"1"],["Mar 23 2016 16: +0",3.811,"6"],["Mar 23 2016 17: +0",3.866,"1"],["Mar 23 2016 19: +0",3.706,"1"],["Mar 23 2016 20: +0",3.808,"3"],["Mar 23 2016 21: +0",3.884,"3"],["Mar 23 2016 23: +0",3.869,"2"],["Mar 24 2016 01: +0",3.653,"2"],["Mar 24 2016 02: +0",3.842,"1"],["Mar 24 2016 04: +0",3.679,"1"],["Mar 24 2016 05: +0",3.851,"1"],["Mar 24 2016 07: +0",3.849,"1"],["Mar 24 2016 11: +0",3.887,"1"],["Mar 24 2016 14: +0",3.071,"1"],["Mar 24 2016 15: +0",2.984,"3"],["Mar 24 2016 18: +0",3.092,"3"],["Mar 24 2016 19: +0",3.096,"2"],["Mar 24 2016 21: +0",3.089,"1"],["Mar 24 2016 22: +0",3.098,"3"],["Mar 25 2016 00: +0",3.21,"1"],["Mar 25 2016 01: +0",3.215,"3"],["Mar 25 2016 02: +0",3.281,"2"],["Mar 25 2016 04: +0",3.487,"2"],["Mar 25 2016 08: +0",3.467,"1"],["Mar 25 2016 12: +0",3.387,"1"],["Mar 25 2016 17: +0",3.248,"2"],["Mar 25 2016 18: +0",3.318,"3"],["Mar 25 2016 19: +0",2.949,"2"],["Mar 25 2016 20: +0",2.902,"2"],["Mar 25 2016 21: +0",3.048,"1"],["Mar 25 2016 22: +0",2.989,"2"],["Mar 25 2016 23: +0",2.958,"1"],["Mar 26 2016 00: +0",3.1,"3"],["Mar 26 2016 03: +0",3.196,"5"],["Mar 26 2016 04: +0",3.39,"1"],["Mar 26 2016 05: +0",3.393,"2"],["Mar 26 2016 06: +0",3.401,"1"],["Mar 26 2016 12: +0",3.477,"1"],["Mar 26 2016 13: +0",3.477,"1"],["Mar 26 2016 17: +0",3.263,"2"],["Mar 26 2016 19: +0",3.199,"1"],["Mar 26 2016 20: +0",3.199,"3"],["Mar 26 2016 21: +0",3.342,"1"],["Mar 26 2016 22: +0",3.482,"5"],["Mar 27 2016 01: +0",3.936,"5"],["Mar 27 2016 02: +0",3.936,"3"],["Mar 27 2016 03: +0",3.906,"1"],["Mar 27 2016 04: +0",3.931,"1"],["Mar 27 2016 05: +0",3.931,"1"],["Mar 27 2016 12: +0",2.989,"1"],["Mar 27 2016 14: +0",3.155,"3"],["Mar 27 2016 15: +0",2.889,"2"],["Mar 27 2016 16: +0",3.528,"1"],["Mar 27 2016 17: +0",3.627,"1"],["Mar 27 2016 18: +0",3.503,"3"],["Mar 27 2016 19: +0",3.663,"1"],["Mar 27 2016 20: +0",3.503,"3"],["Mar 27 2016 22: +0",3.628,"1"],["Mar 27 2016 23: +0",3.647,"3"],["Mar 28 2016 03: +0",3.663,"2"],["Mar 28 2016 05: +0",3.059,"1"],["Mar 28 2016 06: +0",3.047,"1"],["Mar 28 2016 07: +0",3.336,"2"],["Mar 28 2016 08: +0",3.663,"1"],["Mar 28 2016 11: +0",3.757,"2"],["Mar 28 2016 12: +0",3.796,"1"],["Mar 28 2016 13: +0",3.93,"1"],["Mar 28 2016 14: +0",3.874,"1"],["Mar 28 2016 17: +0",3.632,"2"],["Mar 28 2016 20: +0",3.716,"1"],["Mar 28 2016 23: +0",3.565,"1"],["Mar 29 2016 01: +0",3.672,"4"],["Mar 29 2016 03: +0",3.753,"1"],["Mar 29 2016 04: +0",3.762,"1"],["Mar 29 2016 08: +0",3.93,"3"],["Mar 29 2016 09: +0",3.931,"1"],["Mar 29 2016 11: +0",3.02,"5"],["Mar 29 2016 14: +0",3.771,"1"],["Mar 29 2016 17: +0",3.791,"1"],["Mar 29 2016 21: +0",3.385,"2"],["Mar 30 2016 00: +0",3.699,"1"]]';
		body = JSON.parse(body);
		callback_params.unshift(body);
		callback(callback_params);
		/*request(api_call, function (error, response, body) {
			if (!error && response.statusCode == 200) {
				callback_params.unshift(JSON.parse(body));
				callback(callback, callback_params);
				return true;
			}
		});*/
	}

	var store_data = function(data, tournament, team, sticker_type) {
			_.each(data, function(entry, index) {
				var datetime = entry[0];
				var price = entry[1];
				var quantity = entry[2];

				db.collection(db_name).insertOne( {
						"team": ObjectID(team),
						"tournament": ObjectID(tournament),
						"type": sticker_type,
						"datetime": datetime,
						"price": price,
						"quantity": quantity
					}, 
					function(err, result) {
						test.equal(err, null);
						console.log("Inserted a document into collection.");
						db.close();
					}
				);
			});
	}

	var migrate_tournament = function(tournament) {
		//(stickers, sticker-type, index)
		_.each(tournament_sm[tournament], function(value, sticker_type, index) {
			_.each(value, function(sticker, team) {
				var result = JSON.parse(get_data(sticker, true));
				store_data(result, tournament, team, sticker_type);
			});
		});
	}

	var migrate_team = function(team) {
		//(stickers, sticker-type, index)
		_.each(team_sm[team], function(value, sticker_type, index) {
			_.each(value, function(sticker, tournament) {
				get_data(sticker, store_data, new Array(tournament, team, sticker_type), true);
			});
		});	
	}

	var initialize_teams = function() {
		//Initialize Teams
		_.each(team_map, function(value, key, index) {
			db.collection(db_name).insertOne( {
					"_id": key,
					"name": key,
					"abbreviation": value,
					"stats": {}
				}, 
				function(err, result) {
					test.equal(err, null);
					console.log("Inserted a document into collection.");
				}
			);
		});
	}

	var initialize_tournaments = function() {
		//Initialize Tournaments
		_.each(tournament_map, function(value, key, index) {
			db.collection(db_name).insertOne( {
					"_id": key,
					"name": key,
					"fullname": value["fullname"],
					"location": value["location"],
					"prizepool": value["prizepool"],
					"start": value["start"],
					"end": value["end"],
					"stats": {}
				}, 
				function(err, result) {
					test.equal(err, null);
					console.log("Inserted a document into collection.");
				}
			);
		});
	}

	/** 
	**	Main
	**/
	initialize_teams();
	initialize_tournaments();

	//migrate_team("Cloud9");
	//migrate_tournament("Katowice 2015");

});