var request = require('request');
var _ = require('underscore');
var sm = require('StickerMap').StickerMap;

//id = [stickername], time=[past x days], full=[get full sales history]
var get_data = function(id, full, time) {
	var base_api = "http://csgobackpack.net/api/GetItemPrice/";
	var params = {"currency": "USD", "id": id};

	if(full) {
		params["full"] = full;
	}
	if(time) {
		params["time"] = time;
	}
	
	//Construct api call request string
	var api_call = base_api;
	var index = 0;
	_.each(params, function(value, key) {
		if(index == 0) {
			api_call += "?";
		} else {
			api_call += "&";
		}
		api_call += key + "=" + encodeURI(value);
		++index;
	});

	console.log("Making request to: " + api_call);
	request(api_call, function (error, response, body) {
		if (!error && response.statusCode == 200) {
			return body;
		}
	});
}

var migrate_tournament = function(tournament) {
	//(stickers, sticker-type, index)
	_.each(sm[tournament], function(value, key, index) {
		_.each(value, function(sticker) {
			var result = get_data(sticker, true);
		});
	});
}

migrate_tournament("Katowice 2015");